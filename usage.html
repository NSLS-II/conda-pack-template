

<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Usage &#8212; conda-pack-template  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/cloud.css?v=f9ae72be" />
    <link rel="stylesheet" type="text/css" href="_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noticia+Text:400,i,b,bi|Open+Sans:400,i,b,bi|Roboto+Mono:400,i,b,bi&amp;display=swap" type="text/css" />
    
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>

    
    
     
        <script src="_static/jquery.cookie.js"></script>
    

    
     
        <script src="_static/cloud.base.js"></script>
    

    
     
        <script src="_static/cloud.js"></script>
    

    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Frequently Asked Questions" href="faq.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body>
    <div class="relbar-top">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">conda-pack-template  documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Usage</a></li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h1>
<p>The following steps will generate the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> and the <code class="docutils literal notranslate"><span class="pre">runner-*.sh</span></code>
files (from the Jinja2 templates using the parameters from the YAML
configuration file). These files will be used afterwards to run the build of
the environment.</p>
<section id="create-a-dockerfile">
<h2>Create a Dockerfile<a class="headerlink" href="#create-a-dockerfile" title="Link to this heading">¶</a></h2>
<p>In order to build the conda environment for a specific platform (e.g., Linux),
we create a Docker image matching the target platform. Even if the environment
is built on a specific Linux version, such as CentOS7, it can still be used for
other Linux flavors (e.g., Debian, RedHat, etc.) as long as the version of
<strong>glibc</strong> on the target platform is higher than the one in the build system’s
OS.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please refer to <a class="reference external" href="https://conda.github.io/conda-pack">https://conda.github.io/conda-pack</a> for the limitations.
E.g., the OS where the environment was built must match the OS of the
target. This means that environments built on Windows can’t be relocated to
Linux.</p>
</div>
<p>At top level of the repository, generate the <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> with this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>render.py<span class="w"> </span>-c<span class="w"> </span>configs/&lt;env-name&gt;.yml<span class="w"> </span>-f<span class="w"> </span>Dockerfile.j2
</pre></div>
</div>
<p>The resulting <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> will contain the instructions on how to build the
corresponding Docker image with the conda environment inside. The conda
environment is specified either via the environment file, or with the list of
packages and extra-packages.</p>
</section>
<section id="create-a-runner-script">
<h2>Create a runner script<a class="headerlink" href="#create-a-runner-script" title="Link to this heading">¶</a></h2>
<p>The runner script is used to (i) build the Docker image based on the
<code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> from the previous step, (ii) run a Docker container based on
that image with a mounted host directory, and (iii) export the artifacts to the
<code class="docutils literal notranslate"><span class="pre">artifacts/</span></code> directory on the host system.</p>
<p>To generate the <code class="docutils literal notranslate"><span class="pre">runner-*.sh</span></code> file, run this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python3<span class="w"> </span>render.py<span class="w"> </span>-c<span class="w"> </span>configs/&lt;env-name&gt;.yml<span class="w"> </span>-f<span class="w"> </span>runner.sh.j2
</pre></div>
</div>
</section>
<section id="run-the-build">
<h2>Run the build<a class="headerlink" href="#run-the-build" title="Link to this heading">¶</a></h2>
<p>Run the resulting <code class="docutils literal notranslate"><span class="pre">runner-*.sh</span></code> file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>bash<span class="w"> </span>./runner-&lt;env-name&gt;.sh
</pre></div>
</div>
<p>After running this script, the following files will be produced in the
<code class="docutils literal notranslate"><span class="pre">artifacts/</span></code> directory:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;env-name&gt;.tar.gz</span></code> is the tarball with the conda environment packaged with
conda-pack;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;env-name&gt;-md5sum.txt</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;env-name&gt;-sha256sum.txt</span></code> are the files
containing MD5 and SHA256 checksums respectively, which can be used to
validate the integrity of the tarball file in various places (e.g., Zenodo
uses MD5 checksums, while NSLS-II Ansible deployment roles use SHA256
checksums);</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">&lt;env-name&gt;.yml</span></code> is the file produced by the <code class="docutils literal notranslate"><span class="pre">conda</span> <span class="pre">env</span> <span class="pre">export</span></code> command,
which lists all the packages and their versions in the conda environment.</p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div class="sphinx-toc sphinxglobaltoc">
<h3><a href="index.html">Table of Contents</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-a-dockerfile">Create a Dockerfile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-runner-script">Create a runner script</a></li>
<li class="toctree-l2"><a class="reference internal" href="#run-the-build">Run the build</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/nsls2-conda-envs/conda-pack-template">conda-pack-template GitHub repo</a></li>
<li class="toctree-l1"><a class="reference external" href="https://conda.github.io/conda-pack">conda-pack docs</a></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
    
    
        <div class="sidebar-toggle-group no-js">
            
            <button class="sidebar-toggle" id="sidebar-hide" title="Hide the sidebar menu">
                 «
                <span class="show-for-small">hide menu</span>
                
            </button>
            <button class="sidebar-toggle" id="sidebar-show" title="Show the sidebar menu">
                
                <span class="show-for-small">menu</span>
                <span class="hide-for-small">sidebar</span>
                 »
            </button>
        </div>
    
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="faq.html" title="Frequently Asked Questions"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="installation.html" title="Installation"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">conda-pack-template  documentation</a> &#187;</li>

        <li class="nav-item nav-item-this"><a href="">Usage</a></li> 
      </ul>
    </div>
    </div>

    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, Brookhaven National Laboratory.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.5.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>